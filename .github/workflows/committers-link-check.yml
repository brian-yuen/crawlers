name: Download Latest Zip File from Newest Folder

on:
  workflow_dispatch:
    inputs:
      committer_type:
        type: string

jobs:
  download:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Find and download zip file from newest folder
        run: |
          # Define URL of the page containing the list of folders
          base_url="https://repo1.maven.org/maven2/com/norconex/collectors/norconex-committer-${{inputs.committer_type}}/"

          # Extract the list of folder base_urls from the page
          all_folders=$(curl -s "$base_url" | grep -oP '(?<=href=")[^"]+/' | sort -r)

          # Get the URL of the newest folder
          newest_folder_url=$(echo "$all_folders" | head -n 1)

          echo "newest folder is: $newest_folder_url"

          # Save the folder name without the trailing slash into a variable
          folder_name="${newest_folder_url%/}"

          echo "foldername: $folder_name"

          # Download the zip file from the newest folder
          ZIP_FILE_URL="${base_url}${newest_folder_url}norconex-committer-${{inputs.committer_type}}-$folder_name.zip"
          
          echo "zip file url: $ZIP_FILE_URL"
          
          #curl -L -o latest.zip "$ZIP_FILE_URL"

          # Unzip the downloaded file
          #unzip latest.zip
